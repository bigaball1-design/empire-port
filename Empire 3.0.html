<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Port Empire 3.0</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #070707; --card: #111; --text: #eee; --dim: #666; --up: #00ff88; --down: #ff3344; --accent: #222; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 15px; }
        header { border-bottom: 1px solid var(--accent); padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        h1 { font-family: 'JetBrains Mono'; font-size: 1.2rem; color: var(--up); margin: 0; }
        .summary-bar { background: var(--card); border: 1px solid var(--accent); padding: 15px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; border-radius: 8px; }
        .summary-item span { display: block; font-size: 0.6rem; color: var(--dim); margin-bottom: 2px; text-transform: uppercase; }
        .summary-item b { font-family: 'JetBrains Mono'; font-size: 1.1rem; }
        .list-header, .stock-row { display: grid; grid-template-columns: 1.2fr 1fr 1.2fr 1fr 1fr; gap: 8px; align-items: center; }
        .list-header { padding: 0 10px 10px; color: var(--dim); font-size: 0.55rem; text-transform: uppercase; font-weight: 700; }
        .stock-row { background: var(--card); border: 1px solid var(--accent); margin-bottom: 8px; padding: 12px 10px; border-radius: 6px; font-size: 0.85rem; }
        .ticker-info b { font-family: 'JetBrains Mono'; font-size: 1rem; color: var(--up); display: block; }
        .ticker-info i { font-size: 0.6rem; color: var(--dim); display: block; font-style: normal; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-box b { display: block; font-size: 0.9rem; font-family: 'JetBrains Mono'; }
        .p-box i { font-size: 0.65rem; color: var(--dim); font-style: normal; display: block; }
        .bar-bg { height: 4px; background: #222; border-radius: 2px; margin-top: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--up); width: 0%; transition: 1s; }
        .up { color: var(--up) !important; } .down { color: var(--down) !important; }
        .chart-container { background: var(--card); border: 1px solid var(--accent); padding: 15px; border-radius: 8px; margin-top: 20px; }
        @media (max-width: 600px) { .list-header { display: none; } .stock-row { grid-template-columns: 1fr 1fr; gap: 15px; } .chart-container { height: 250px; } }
    </style>
</head>
<body>
    <header><h1>PORT_EMPIRE_3.0</h1><div id="sync-info" style="font-size: 0.6rem; color: var(--dim);">SYSTEM_READY...</div></header>
    <div class="summary-bar">
        <div class="summary-item"><span>Net Worth (USD)</span><b id="total-usd">$0.00</b></div>
        <div class="summary-item"><span>Net Worth (THB)</span><b id="total-thb">฿0</b></div>
        <div class="summary-item"><span>Profit/Loss (%)</span><b id="total-pl">0.00%</b></div>
        <div class="summary-item"><span>USD/THB Rate</span><b id="fx-rate">0.00</b></div>
    </div>
    <div class="list-header"><div>Asset</div><div>Price</div><div>Value</div><div>P/L</div><div>Target</div></div>
    <div id="stock-list"></div>
    <div class="chart-container">
        <div style="font-family:'JetBrains Mono'; font-size: 0.7rem; margin-bottom: 10px; color: var(--dim);">// WEEKLY_GROWTH_PROJECTION</div>
        <canvas id="growthChart"></canvas>
    </div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTQxEdO_NiXSTfy_96k0yL4rm-i9Ap3PwsIAzm4D3UlUVuntBqanNjChBCfB-ylKgWvYYI6kxIThfk-/pub?gid=1701656193&single=true&output=csv';
    let LIVE_FX = 36.50, myChart = null;

    function clean(v) { 
        if(!v || v.toString().trim()==="" || v=="#N/A") return 0;
        let n = parseFloat(v.toString().replace(/[^0-9.-]+/g, ""));
        return isNaN(n) ? 0 : n;
    }

    async function update() {
        try {
            const fx = await fetch('https://open.er-api.com/v6/latest/USD').then(r => r.json());
            LIVE_FX = fx.rates.THB;
            const text = await fetch(CSV_URL).then(r => r.text());
            const rows = text.split('\n').slice(1).map(r => r.split(',')).filter(r => r[0] && clean(r[5]) > 0);
            render(rows);
        } catch (e) { console.error(e); }
    }

    function render(rows) {
        const container = document.getElementById('stock-list');
        container.innerHTML = '';
        let tMkt = 0, tCost = 0, tTarget = 0;

        rows.forEach(cols => {
            const ticker = cols[0].trim(), industry = cols[1];
            const price = clean(cols[2]), cost = clean(cols[4]), shares = clean(cols[5]), target = clean(cols[7]);
            const mktVal = price * shares, costBasis = cost * shares;
            const plUsd = mktVal - costBasis, plPct = costBasis > 0 ? (plUsd / costBasis) * 100 : 0;
            const progress = target > 0 ? Math.min((price / target) * 100, 100) : 0;
            
            tMkt += mktVal; tCost += costBasis; tTarget += (target * shares);

            container.innerHTML += `
                <div class="stock-row">
                    <div class="ticker-info"><b>${ticker}</b><i>${industry}</i></div>
                    <div class="p-box"><b>$${price.toFixed(2)}</b><i>฿${(price*LIVE_FX).toFixed(2)}</i></div>
                    <div class="p-box"><b class="up">$${mktVal.toLocaleString(undefined,{maximumFractionDigits:0})}</b><i>฿${(mktVal*LIVE_FX).toLocaleString(undefined,{maximumFractionDigits:0})}</i></div>
                    <div class="p-box"><b class="${plUsd>=0?'up':'down'}">${plUsd>=0?'+':''}${plUsd.toFixed(0)}</b><i class="${plUsd>=0?'up':'down'}">${plPct.toFixed(1)}%</i></div>
                    <div>
                        <div style="display:flex; justify-content:space-between; font-size:0.55rem; color:var(--dim)"><span>TGT $${target}</span><span>${progress.toFixed(0)}%</span></div>
                        <div class="bar-bg"><div class="bar-fill" style="width:${progress}%"></div></div>
                    </div>
                </div>`;
        });

        const totalPlPct = tCost > 0 ? ((tMkt - tCost) / tCost) * 100 : 0;
        document.getElementById('total-usd').innerText = `$${tMkt.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
        document.getElementById('total-thb').innerText = `฿${(tMkt*LIVE_FX).toLocaleString(undefined, {maximumFractionDigits: 0})}`;
        document.getElementById('total-pl').innerText = `${totalPlPct>=0?'+':''}${totalPlPct.toFixed(2)}%`;
        document.getElementById('total-pl').className = totalPlPct >= 0 ? 'up' : 'down';
        document.getElementById('fx-rate').innerText = LIVE_FX.toFixed(2);
        document.getElementById('sync-info').innerText = `SYNC: ${new Date().toLocaleTimeString()}`;
        
        initChart(tMkt, tTarget);
    }

    function initChart(current, target) {
        const ctx = document.getElementById('growthChart').getContext('2d');
        const labels = ['Now', 'W4', 'W8', 'W12', 'W16', 'W20', 'Target'];
        
        // เส้นเป้าหมาย (คำนวณจากเป้าที่อยากไปถึง)
        const step = (target - current) / 6;
        const targetPath = labels.map((_, i) => (current + (step * i)).toFixed(2));
        
        // เส้นมูลค่าปัจจุบัน (แสดงเป็นจุดเริ่มต้น)
        const currentStatus = labels.map((_, i) => i === 0 ? current : null);

        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Target Path',
                        data: targetPath,
                        borderColor: '#444',
                        borderDash: [5, 5],
                        fill: false
                    },
                    {
                        label: 'Current Value',
                        data: currentStatus,
                        borderColor: '#00ff88',
                        backgroundColor: '#00ff88',
                        pointRadius: 6,
                        showLine: false
                    }
                ]
            },
            options: {
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    y: { grid: { color: '#222' }, ticks: { color: '#666' } },
                    x: { grid: { display: false }, ticks: { color: '#666' } }
                }
            }
        });
    }
    update(); setInterval(update, 600000);
</script>
</body>
</html>

